<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ› æŒ‰é’®ç‚¹å‡»è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        button { background-color: #8B5CF6; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #7C3AED; }
        button:disabled { background-color: #9CA3AF; cursor: not-allowed; }
        .form-group { margin: 15px 0; }
        input, textarea, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        .result { margin: 15px 0; padding: 15px; border-radius: 4px; border: 1px solid #ddd; }
        .success { background-color: #D1FAE5; color: #065F46; }
        .error { background-color: #FEE2E2; color: #991B1B; }
        .debug-info { background-color: #1F2937; color: #F9FAFB; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› è¡¨å•æŒ‰é’®ç‚¹å‡»è°ƒè¯•</h1>
        <p>ç”¨äºæµ‹è¯•è¡¨å•æäº¤æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        
        <form id="testForm">
            <div class="form-group">
                <label>è§†é¢‘æ—¶é•¿ï¼š</label>
                <select name="duration" required>
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="24" selected>24ç§’ (æ¨è)</option>
                    <option value="30">30ç§’</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>äº§å“æè¿°ï¼š</label>
                <textarea name="productDescription" placeholder="è¯·è¾“å…¥äº§å“æè¿°..." required>ä»Šå¤©æˆ‘ä»¬è‰ºç«™lobosè€å¸ˆå¸¦æˆ‘ä»¬åœ¨å…¬å›­ä¸Šäº†ä¸€èŠ‚æˆ·å¤–å†™ç”Ÿè¯¾ï¼Œé˜³å…‰ç‰¹åˆ«å¥½ï¼Œå¤§å®¶éƒ½å¾ˆå…´å¥‹ã€‚</textarea>
            </div>
            
            <div class="form-group">
                <label>äº§å“å›¾ç‰‡URLï¼š</label>
                <input type="url" name="imageUrl" placeholder="https://example.com/image.jpg" value="https://youke1.picui.cn/s1/2025/09/18/68cb9660072c4.jpg" required />
            </div>
            
            <div class="form-group">
                <label>äººç‰©æ€§åˆ«ï¼š</label>
                <select name="characterGender" required>
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="female" selected>å¥³æ€§</option>
                    <option value="male">ç”·æ€§</option>
                </select>
            </div>
            
            <button type="submit" id="submitBtn">ğŸš€ å‘é€åˆ°AIåˆ›å»ºè§†é¢‘</button>
        </form>
        
        <div id="results"></div>
        
        <div class="debug-info">
            <strong>è°ƒè¯•æ—¥å¿—:</strong>
            <div id="debugLog"></div>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://n8n-worker-k4m9.zeabur.app/webhook/9d5986f5-fcba-42bf-b3d7-5fd94660943a/chat';
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('debugLog');
            logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(message);
        }
        
        function addResult(type, content) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = content;
            resultsDiv.appendChild(resultDiv);
        }
        
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            log('ğŸ¯ è¡¨å•æäº¤äº‹ä»¶è§¦å‘');
            
            const formData = new FormData(e.target);
            const data = {
                duration: formData.get('duration'),
                productDescription: formData.get('productDescription'),
                imageUrl: formData.get('imageUrl'),
                characterGender: formData.get('characterGender')
            };
            
            log('ğŸ“‹ æ”¶é›†åˆ°çš„è¡¨å•æ•°æ®: ' + JSON.stringify(data, null, 2));
            
            // éªŒè¯è¡¨å•
            if (!data.duration || !data.productDescription || !data.imageUrl || !data.characterGender) {
                log('âŒ è¡¨å•éªŒè¯å¤±è´¥');
                addResult('error', 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                return;
            }
            
            log('âœ… è¡¨å•éªŒè¯é€šè¿‡ï¼Œå‡†å¤‡å‘é€åˆ°N8n');
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'æ­£åœ¨å‘é€...';
            
            try {
                const messageContent = `è§†é¢‘åˆ›ä½œéœ€æ±‚ï¼š
ğŸ¬ è§†é¢‘æ—¶é•¿ï¼š${data.duration}ç§’
ğŸ“ äº§å“æè¿°ï¼š${data.productDescription}
ğŸ–¼ï¸ äº§å“å›¾ç‰‡ï¼š${data.imageUrl}
ğŸ‘¤ äººç‰©æ€§åˆ«ï¼š${data.characterGender}

è¯·æ ¹æ®ä»¥ä¸Šä¿¡æ¯åˆ›å»ºè§†é¢‘å†…å®¹ã€‚`;
                
                const sessionId = `debug_test_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`;
                
                const payload = {
                    action: "sendMessage",
                    sessionId: sessionId,
                    chatInput: messageContent
                };
                
                log('ğŸ“¤ å‘é€è½½è·: ' + JSON.stringify(payload, null, 2));
                
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                log(`ğŸ“¡ HTTPå“åº”: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const responseData = await response.text();
                    log('âœ… N8nå“åº”: ' + responseData.substring(0, 200));
                    addResult('success', `æˆåŠŸå‘é€åˆ°N8n!<br><pre>${responseData}</pre>`);
                } else {
                    const errorData = await response.text();
                    log('âŒ N8né”™è¯¯: ' + errorData);
                    addResult('error', `å‘é€å¤±è´¥: ${response.status}<br>${errorData}`);
                }
                
            } catch (error) {
                log('âŒ ç½‘ç»œé”™è¯¯: ' + error.message);
                addResult('error', 'ç½‘ç»œè¿æ¥å¤±è´¥: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸš€ å‘é€åˆ°AIåˆ›å»ºè§†é¢‘';
            }
        });
        
        // æ£€æµ‹æŒ‰é’®ç‚¹å‡»
        document.getElementById('submitBtn').addEventListener('click', function(e) {
            log('ğŸ–±ï¸ æŒ‰é’®ç‚¹å‡»äº‹ä»¶æ£€æµ‹åˆ°');
        });
        
        window.onload = function() {
            log('ğŸ”§ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è°ƒè¯•');
            addResult('success', 'è°ƒè¯•é¡µé¢å·²å‡†å¤‡å¥½ï¼Œè¯·ç‚¹å‡»æŒ‰é’®æµ‹è¯•');
        };
    </script>
</body>
</html>