<!DOCTYPE html>
<html>
<head>
  <title>ç”¨æˆ·çŠ¶æ€è¯Šæ–­</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #f5f5f5; }
    .section { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .label { font-weight: bold; color: #333; }
    .value { color: #0066cc; }
    .error { color: #cc0000; }
    .success { color: #00cc00; }
    pre { background: #f0f0f0; padding: 10px; overflow: auto; }
  </style>
</head>
<body>
  <h1>ğŸ” ç”¨æˆ·çŠ¶æ€è¯Šæ–­å·¥å…·</h1>
  
  <div class="section">
    <h2>LocalStorage æ•°æ®</h2>
    <div id="localStorage-data"></div>
  </div>
  
  <div class="section">
    <h2>SessionStorage æ•°æ®</h2>
    <div id="sessionStorage-data"></div>
  </div>
  
  <div class="section">
    <h2>å½“å‰ç”¨æˆ·ä¿¡æ¯</h2>
    <div id="current-user"></div>
  </div>
  
  <div class="section">
    <h2>Difyç›¸å…³æ•°æ®</h2>
    <div id="dify-data"></div>
  </div>

  <script>
    // æ˜¾ç¤ºlocalStorageæ•°æ®
    const localStorageDiv = document.getElementById('localStorage-data');
    const localData = {};
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      localData[key] = localStorage.getItem(key);
    }
    localStorageDiv.innerHTML = '<pre>' + JSON.stringify(localData, null, 2) + '</pre>';
    
    // æ˜¾ç¤ºsessionStorageæ•°æ®
    const sessionStorageDiv = document.getElementById('sessionStorage-data');
    const sessionData = {};
    for (let i = 0; i < sessionStorage.length; i++) {
      const key = sessionStorage.key(i);
      sessionData[key] = sessionStorage.getItem(key);
    }
    sessionStorageDiv.innerHTML = '<pre>' + JSON.stringify(sessionData, null, 2) + '</pre>';
    
    // æ˜¾ç¤ºå½“å‰ç”¨æˆ·
    const currentUserDiv = document.getElementById('current-user');
    const currentUser = localStorage.getItem('currentUser');
    if (currentUser) {
      try {
        const user = JSON.parse(currentUser);
        currentUserDiv.innerHTML = `
          <p><span class="label">ç”¨æˆ·ID:</span> <span class="value">${user.id || 'æœªçŸ¥'}</span></p>
          <p><span class="label">Email:</span> <span class="value">${user.email || 'æœªçŸ¥'}</span></p>
          <p><span class="label">ä½™é¢:</span> <span class="value">${user.balance || 0} ç§¯åˆ†</span></p>
          <p><span class="label">åå­—:</span> <span class="value">${user.name || 'æœªè®¾ç½®'}</span></p>
          <pre>${JSON.stringify(user, null, 2)}</pre>
        `;
      } catch (e) {
        currentUserDiv.innerHTML = '<p class="error">è§£æç”¨æˆ·æ•°æ®å¤±è´¥: ' + e.message + '</p>';
      }
    } else {
      currentUserDiv.innerHTML = '<p class="error">âš ï¸ æœªæ‰¾åˆ°currentUseræ•°æ®ï¼ˆå¯èƒ½æœªç™»å½•ï¼‰</p>';
    }
    
    // æ˜¾ç¤ºDifyæ•°æ®
    const difyDataDiv = document.getElementById('dify-data');
    const difyUserId = localStorage.getItem('dify_user_id');
    const difyConversationId = localStorage.getItem('dify_conversation_id');
    const difyWorkflowState = localStorage.getItem('dify_workflow_state');
    
    difyDataDiv.innerHTML = `
      <p><span class="label">Dify User ID:</span> <span class="value">${difyUserId || 'æœªè®¾ç½®'}</span></p>
      <p><span class="label">Dify Conversation ID:</span> <span class="value">${difyConversationId || 'æœªè®¾ç½®'}</span></p>
      <p><span class="label">Workflow State:</span> <span class="value">${difyWorkflowState || 'æœªè®¾ç½®'}</span></p>
    `;
    
    // æ·»åŠ è¯Šæ–­å»ºè®®
    const diagnosis = document.createElement('div');
    diagnosis.className = 'section';
    diagnosis.innerHTML = '<h2>ğŸ” è¯Šæ–­å»ºè®®</h2><div id="diagnosis-content"></div>';
    document.body.appendChild(diagnosis);
    
    const diagnosisContent = document.getElementById('diagnosis-content');
    let suggestions = [];
    
    if (!currentUser) {
      suggestions.push('âŒ <strong>é—®é¢˜ï¼šæœªç™»å½•</strong> - è¯·å…ˆç™»å½•è´¦æˆ·');
    } else {
      try {
        const user = JSON.parse(currentUser);
        if (user.balance === 100) {
          suggestions.push('âš ï¸ <strong>ä½™é¢æ˜¾ç¤º100</strong> - å¯èƒ½æ˜¯åˆå§‹å€¼æˆ–ç¼“å­˜æ•°æ®ï¼Œè¯·åˆ·æ–°é¡µé¢');
        }
        if (!user.id || !user.id.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i)) {
          suggestions.push('âŒ <strong>ç”¨æˆ·IDæ— æ•ˆ</strong> - ä¸æ˜¯æœ‰æ•ˆçš„UUIDæ ¼å¼');
        }
      } catch (e) {}
    }
    
    if (!difyUserId || difyUserId.startsWith('fresh-user-')) {
      suggestions.push('âš ï¸ <strong>ä½¿ç”¨ä¸´æ—¶ç”¨æˆ·ID</strong> - ç§¯åˆ†ä¸ä¼šä»æ•°æ®åº“æ‰£é™¤');
    }
    
    if (suggestions.length === 0) {
      suggestions.push('âœ… <strong>çœ‹èµ·æ¥æ­£å¸¸</strong> - ä½†å¦‚æœç§¯åˆ†æ²¡æœ‰æ‰£é™¤ï¼Œè¯·è”ç³»ç®¡ç†å‘˜');
    }
    
    diagnosisContent.innerHTML = suggestions.join('<br>');
  </script>
</body>
</html>
